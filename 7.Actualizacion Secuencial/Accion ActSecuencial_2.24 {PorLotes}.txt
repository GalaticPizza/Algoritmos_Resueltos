Accion ActSecuencial_2.24 Es 		//Leonardo,Brabo
	AMBIENTE

	FECHA= REGISTRO
		AA: N(4);
		MM: 1..12;
		DD: 1..31;
	FR;

	CPA = REGISTRO
		COD_AFIL: N(5); 
		FECHA_ALTA: FECHA;
		FECHA_BAJA: FECHA;
		CANT_SERV: N(2);
		COSTO: N;
	FR;

	SERSEM = REGISTRO
		COD_AFIL: N(5);
		FECHA_AT: FECHA;
		COD_SERV: N;
		COSTO: N;
	FR;

	AMAE, ASAL: Archivo de CPA ordenado por COD_AFIL;
	RMAE, RSAL: CPA;

	AMOV: Archivo de SERSEM ordenado por COD_AFIL, FECHA_AT;
	RMOV: SERSEM;

	CONTSER, CONCOST : ENTERO;

	SUBACCION LEER_MAE ES
		LEER(AMAE,RMAE);
		SI FDA(AMAE) ENTONCES
			RMAE.COD_AFIL:= HV;
		FS;
	FR;

	SUBACCION LEER_MOV ES
		LEER(AMOV,RMOV);
		SI FDA(AMOV) ENTONCES
			RMOV.COD_AFIL:= HV;
		FS;
	FR;

	PROCESO

	ABRIR E/(AMAE); ABRIR E/(AMOV); ABRIR /S(ASAL);
	LEER_MAE; LEER_MOV;
	CONSER:=0; CONCOST:= 0;
	MIENTRAS ((RMA.COD_AFIL <> HV) v (RMOV.COD_AFIL <> HV)) HACER
		SI RMAE.COD_AFIL > RMOV.COD_AFIL ENTONCES
			SI RMOV.COD_SER = 001 ENTONCES
				RSAL.COD_AFIL:= RMOV.COD_AFIL;
				RSAL.FECHA_ALTA:= RMOV.FECHA_AT;
				RSAL.COST:= RMOV.COSTO;
				ESCRIBIR(ASAL,RSAL);
			SINO
				ESCRIBIR("ERROR ALTA");
			FS;
			LEER_MOV;
		SINO
			SI RMAE.COD_AFIL = RMOV.COD_AFIL ENTONCES

				MIENTRAS RMOV.COD_AFIL = RMAE.COD_AFIL HACER
					SI RMOV.COD_SERV = 000 ENTONCES
						RSAL:= RMAE;
						RSAL.FECHA_BAJA:= RMOV.FECHA_AT;		
					SINO
						CONTSER:= CONTSER + 1;
						CONTCOST:= CONCOST + RMOV.COSTO;
						RSAL:= RMAE;
						RSAL.CANT_SERV:= RSAL.CANT_SERV + CONTSER;
						RSAL.COSTO:= RSAL.COSTO + CONCOST;
					FS;
					LEER_MOV;
				FM;
				ESCRIBIR(ASAL,RSAL);
				LEER_MAE;
			SINO 
				SI RMAE.COD_AFIL < RMOV.COD_AFIL ENTONCES
					RSAL:= RMAE;
					ESCRIBIR(ASAL,RSAL);
					LEER_MAE;
				FS;
			FS;
		FS;
	FM;
	CERRAR(AMAE); CERRAR(ASAL); CERRAR(AMOV);
Fin_Accion.





